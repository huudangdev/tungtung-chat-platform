{"version":3,"file":"api.js","sourceRoot":"","sources":["../../../src/lib/api/api.ts"],"names":[],"mappings":"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","sourcesContent":["import { logger as Logger } from '../log'\n\nimport {\n\tILogger,\n\tILoginResultAPI,\n\tIAPIRequest,\n\tIMessage,\n\tICredentials\n} from '../../interfaces'\n\nimport { Message } from '../message'\n\nimport { EventEmitter } from 'tiny-events'\n\n/** Check for existing login */\n// export function loggedIn () {\n//   return (currentLogin !== null)\n// }\n\n/**\n\t* Prepend protocol (or put back if removed from env settings for driver)\n\t* Hard code endpoint prefix, because all syntax depends on this version\n\t*/\n// export const url = `${(host.indexOf('http') === -1) ? host.replace(/^(\\/\\/)?/, 'http://') : host}/api/v1/`\n\n/** Populate auth headers (from response data on login) */\n// export function setAuth (authData: {authToken: string, userId: string}) {\n//   client.defaults.headers.common['X-Auth-Token'] = authData.authToken\n//   client.defaults.headers.common['X-User-Id'] = authData.userId\n// }\n\n// /** Clear headers so they can't be used without logging in again */\n// export function clearHeaders () {\n//   delete client.defaults.headers.common['X-Auth-Token']\n//   delete client.defaults.headers.common['X-User-Id']\n// }\n\n// /**\n// \t* Login a user for further API calls\n// \t* Result should come back with a token, to authorise following requests.\n// \t* Use env default credentials, unless overridden by login arguments.\n// \t*/\n// export async function login (user: ICredentialsAPI = { username, password }) {\n//   this.logger.info(`[API] Logging in ${user.username}`)\n//   if (currentLogin !== null) {\n//     this.logger.debug(`[API] Already logged in`)\n//     if (currentLogin.username === user.username) return currentLogin.result\n//     else await logout()\n//   }\n//   const result = (await this.post('login', user, false) as ILoginResultAPI)\n//   if (result && result.data && result.data.authToken) {\n//     currentLogin = {\n//       result: result, // keep to return if login requested again for same user\n//       username: user.username, // keep to compare with following login attempt\n//       authToken: result.data.authToken,\n//       userId: result.data.userId\n//     }\n//     setAuth(currentLogin)\n//     this.logger.info(`[API] Logged in ID ${currentLogin.userId}`)\n//     return result\n//   } else {\n//     throw new Error(`[API] Login failed for ${user.username}`)\n//   }\n// }\n\n// /** Logout a user at end of API calls */\n// export function logout () {\n//   if (currentLogin === null) {\n//     this.logger.debug(`[API] Already logged out`)\n//     return Promise.resolve()\n//   }\n//   this.logger.info(`[API] Logging out ${ currentLogin.username }`)\n//   return this.get('logout', null, true).then(() => {\n//     clearHeaders()\n//     currentLogin = null\n//   })\n// }\n\nexport interface IClient {\n  headers: any\n  get (url: string, data: any, options?: any): Promise<any>\n  post (url: string, data: any, options?: any): Promise<any>\n  put (url: string, data: any, options?: any): Promise<any>\n  delete (url: string, data: any, options?: any): Promise<any>\n}\n\nclass Client implements IClient {\n  host: string\n\n  _headers: any = {}\n\n  constructor ({ host = 'http://localhost:3000' }: any) {\n    this.host = host\n  }\n\n  set headers (obj: any) {\n    this._headers = obj\n  }\n  get headers (): any {\n    return {\n      'Content-Type': 'application/json',\n      ...this._headers\n    }\n  }\n\n  getHeaders (options?: any) {\n    return options && options.customHeaders ?\n      options.customHeaders :\n      this.headers\n  }\n\n  getBody (data: any) {\n    return data instanceof FormData ?\n      data :\n      JSON.stringify(data)\n  }\n\n  get (url: string, data: any, options?: any): Promise<any> {\n    return fetch(`${this.host}/api/v1/${encodeURI(url)}?${this.getParams(data)}`, {\n      method: 'GET',\n      headers: this.getHeaders(options)\n    }).then(this.handle)\n  }\n  post (url: string, data: any, options?: any): Promise<any> {\n    return fetch(`${this.host}/api/v1/${encodeURI(url)}`, {\n      method: 'POST',\n      body: this.getBody(data),\n      headers: this.getHeaders(options)\n    }).then(this.handle)\n  }\n  put (url: string, data: any, options?: any): Promise<any> {\n    return fetch(`${this.host}/api/v1/${encodeURI(url)}`, {\n      method: 'PUT',\n      body: this.getBody(data),\n      headers: this.getHeaders(options)\n    }).then(this.handle)\n  }\n\n  delete (url: string, data?: any, options?: any): Promise<any> {\n    return fetch(`${this.host}/api/v1/${encodeURI(url)}`, {\n      method: 'DELETE',\n      body: this.getBody(data),\n      headers: this.getHeaders(options)\n    }).then(this.handle)\n  }\n  private async handle (r: any) {\n    const { status } = r\n    const data = await r.json()\n\n    return { status, data }\n\n  }\n  private getParams (data: any) {\n    return Object.keys(data).map(function (k) {\n      return encodeURIComponent(k) + '=' + (typeof data[k] === 'object' ? encodeURIComponent(JSON.stringify(data[k])) : encodeURIComponent(data[k]))\n    }).join('&')\n  }\n}\n\nexport const regExpSuccess = /(?!([45][0-9][0-9]))\\d{3}/\n\n/**\n\t* @module API\n\t* Provides a base client for handling requests with generic Rocket.Chat's REST API\n\t*/\n\nexport default class Api extends EventEmitter {\n  userId: string = ''\n  logger: ILogger\n  client: IClient\n  currentLogin: {\n    username: string,\n    userId: string,\n    authToken: string,\n    result: ILoginResultAPI\n  } | null = null\n\n  constructor ({ client, host, logger = Logger }: any) {\n    super()\n    this.client = client || new Client({ host } as any)\n    this.logger = Logger\n  }\n\n  get username () {\n    return this.currentLogin && this.currentLogin.username\n  }\n\n  loggedIn () {\n    return Object.keys(this.currentLogin || {} as any).every((e: any) => e)\n  }\n/**\n\t* Do a request to an API endpoint.\n\t* If it needs a token, login first (with defaults) to set auth headers.\n\t* @param method   Request method GET | POST | PUT | DEL\n\t* @param endpoint The API endpoint (including version) e.g. `chat.update`\n\t* @param data     Payload for POST request to endpoint\n\t* @param auth     Require auth headers for endpoint, default true\n\t* @param ignore   Allows certain matching error messages to not count as errors\n\t*/\n  request = async (\n\t\tmethod: 'POST' | 'GET' | 'PUT' | 'DELETE',\n\t\tendpoint: string,\n\t\tdata: any = {},\n\t\tauth: boolean = true,\n    ignore?: RegExp,\n    options?: any\n\t) => {\n    this.logger && this.logger.debug(`[API] ${ method } ${ endpoint }: ${ JSON.stringify(data) }`)\n    try {\n      if (auth && !this.loggedIn()) {\n        throw new Error('')\n      }\n      let result\n      switch (method) {\n        case 'GET': result = await this.client.get(endpoint, data, options); break\n        case 'PUT': result = await this.client.put(endpoint, data, options); break\n        case 'DELETE': result = await this.client.delete(endpoint, data, options); break\n        default:\n        case 'POST': result = await this.client.post(endpoint, data, options); break\n      }\n      if (!result) throw new Error(`API ${ method } ${ endpoint } result undefined`)\n      if (!this.success(result, ignore)) throw result\n      this.logger && this.logger.debug(`[API] ${method} ${endpoint} result ${result.status}`)\n      const hasDataInsideResult = result && !result.data\n      return (method === 'DELETE') && hasDataInsideResult ? result : result.data\n    } catch (err) {\n      this.logger && this.logger.error(`[API] POST error(${ endpoint }): ${ JSON.stringify(err) }`)\n      throw err\n    }\n  }\n\t/** Do a POST request to an API endpoint. */\n  post: IAPIRequest = (endpoint, data, auth, ignore, options = {}) => this.request('POST', endpoint, data, auth, ignore, options)\n\n\t/** Do a GET request to an API endpoint. */\n  get: IAPIRequest = (endpoint, data, auth, ignore, options = {}) => this.request('GET', endpoint, data, auth, ignore, options)\n\n\t/** Do a PUT request to an API endpoint. */\n  put: IAPIRequest = (endpoint, data, auth, ignore, options = {}) => this.request('PUT', endpoint, data, auth, ignore, options)\n\n\t/** Do a DELETE request to an API endpoint. */\n  del: IAPIRequest = (endpoint, data, auth, ignore, options = {}) => this.request('DELETE', endpoint, data, auth, ignore, options)\n\n\t/** Check result data for success, allowing override to ignore some errors */\n  success (result: any, ignore?: RegExp) {\n    return (\n\t\t\ttypeof result.status === 'undefined' ||\n\t\t\t(result.status && regExpSuccess.test(result.status)) ||\n\t\t\t(result.status && ignore && ignore.test(result.status))\n\t\t) ? true : false\n  }\n\n  async login (credentials: ICredentials, args?: any): Promise<any> {\n    const { data } = await this.post('login', { ...credentials, ...args })\n    this.userId = data.userId\n    this.currentLogin = {\n      username: data.me.username,\n      userId: data.userId,\n      authToken: data.authToken,\n      result: data\n    }\n    this.client.headers = {\n      'X-Auth-Token': data.authToken,\n      'X-User-Id': data.userId\n    }\n    return data\n  }\n  async logout () {\n    if (!this.currentLogin) {\n      return null\n    }\n    const result = await this.post('logout', {}, true)\n    this.userId = ''\n    this.currentLogin = null\n    return result\n  }\n/**\n * Structure message content, optionally addressing to room ID.\n * Accepts message text string or a structured message object.\n */\n  prepareMessage (\n\tcontent: string | IMessage,\n\trid?: string,\n\targs?: any\n): Message {\n    return new Message(content, { rid, roomId: rid, ...args })\n  }\n}\n"]}